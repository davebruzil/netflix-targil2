<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix - Browse</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="main-header">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a href="main.html" class="navbar-brand me-4">
                    <img src="images/better.png" alt="NETFLIX" class="logo-nav">
                </a>
                
                <div class="navbar-nav d-none d-lg-flex me-auto">
                    <a class="nav-link text-white active" href="main.html" style="margin-right: 20px;">Home</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">TV Shows</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">Movies</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">Games</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">New & Popular</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">My List</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">Browse by Languages</a>
                </div>
                
                <div class="d-flex align-items-center">
                    <div class="search-icon me-3" style="color: white; font-size: 18px; cursor: pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="notifications-icon me-3" style="color: white; font-size: 18px; cursor: pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="dropdown">
                        <div class="profile-dropdown-container d-flex align-items-center" data-bs-toggle="dropdown" style="cursor: pointer;">
                            <div class="profile-icon" id="currentProfileAvatar" style="width: 32px; height: 32px; background-color: #666; border-radius: 4px; overflow: hidden;">
                                <img id="profileImage" src="" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                            </div>
                            <div class="dropdown-arrow ms-1" style="color: white; font-size: 12px;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6 9L12 15L18 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                            <li><a class="dropdown-item" href="profiles.html">Switch Profiles</a></li>
                            <li><a class="dropdown-item" href="#">Account</a></li>
                            <li><a class="dropdown-item" href="#">Help Center</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="netflixLogout()">Sign out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    
    <main class="main-content">
        <!-- Hero Section -->
        <div id="hero-section" class="hero-section" style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://occ-0-2794-2219.1.nflxso.net/dnm/api/v6/6AYY37jfdO6hpXcMjf9Yu5cnmO0/AAAABXYqjKlOlz6xlkwvtdV-YwdBm-GJnPkKoGJJzPaJGXXbT7gzPqQ8wbX4pIoSCu0jD3PL8c9wgkBDBkDpbBu9bkBkP9U.jpg'); background-size: cover; background-position: center; height: 80vh; display: flex; align-items: center; margin-bottom: 60px;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6">
                        <h1 id="hero-title" class="display-4 text-white mb-4" style="font-weight: 700;">Stranger Things</h1>
                        <p id="hero-synopsis" class="lead text-white mb-4">When a young boy vanishes, a small town uncovers a mystery involving secret experiments, terrifying supernatural forces, and one strange little girl.</p>
                        <div class="hero-buttons">
                            <button id="hero-play-btn" class="btn btn-light btn-lg me-3" style="padding: 12px 24px; border-radius: 4px;">
                                ▶️ Play
                            </button>
                            <button id="hero-more-info-btn" class="btn btn-secondary btn-lg" style="padding: 12px 24px; border-radius: 4px; background-color: rgba(109, 109, 110, 0.7); border: none;">
                                ℹ️ More Info
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Netflix-style Content Rows -->
        <div class="netflix-content">
            <!-- Continue Watching Section -->
            <div id="continue-watching-section" class="netflix-row" style="display: none;">
                <div class="row-header">
                    <h2 class="row-title">Continue Watching for <span id="profile-name-display"></span></h2>
                </div>
                <div class="row-slider">
                    <div id="continue-watching-content" class="slider-content">
                        <!-- Continue watching content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Trending Now Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">Trending Now</h2>
                </div>
                <div class="row-slider">
                    <div id="trending-content" class="slider-content">
                        <!-- Trending content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Netflix Originals Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">Netflix Originals</h2>
                </div>
                <div class="row-slider">
                    <div id="originals-content" class="slider-content">
                        <!-- Originals content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Movies Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">Popular Movies</h2>
                </div>
                <div class="row-slider">
                    <div id="movies-content" class="slider-content">
                        <!-- Movies content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- TV Shows Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">TV Shows</h2>
                </div>
                <div class="row-slider">
                    <div id="series-content" class="slider-content">
                        <!-- Series content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Action & Adventure Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">Action & Adventure</h2>
                </div>
                <div class="row-slider">
                    <div id="action-content" class="slider-content">
                        <!-- Action content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Comedies Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">Comedies</h2>
                </div>
                <div class="row-slider">
                    <div id="comedy-content" class="slider-content">
                        <!-- Comedy content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Horror Movies Section -->
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">Horror Movies</h2>
                </div>
                <div class="row-slider">
                    <div id="horror-content" class="slider-content">
                        <!-- Horror content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- My List Section -->
            <div id="my-list-section" class="netflix-row" style="display: none;">
                <div class="row-header">
                    <h2 class="row-title">My List</h2>
                </div>
                <div class="row-slider">
                    <div id="my-list-content" class="slider-content">
                        <!-- My list content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
                    
            <!-- Mobile Menu for smaller screens -->
            <div class="d-md-none mt-4">
                <h4 class="text-white mb-3">Browse Categories</h4>
                <div class="list-group list-group-flush">
                    <a href="main.html" class="list-group-item list-group-item-dark active" style="background-color: #333; color: white; border-color: #333;">
                        🏠 Home
                    </a>
                    <a href="#" class="list-group-item list-group-item-dark" style="background-color: #141414; color: white; border-color: #333;">
                        📺 TV Shows
                    </a>
                    <a href="#" class="list-group-item list-group-item-dark" style="background-color: #141414; color: white; border-color: #333;">
                        🎬 Movies
                    </a>
                    <a href="#" class="list-group-item list-group-item-dark" style="background-color: #141414; color: white; border-color: #333;">
                        🔥 New & Popular
                    </a>
                    <a href="#" class="list-group-item list-group-item-dark" style="background-color: #141414; color: white; border-color: #333;">
                        📝 My List
                    </a>
                    <a href="#" class="list-group-item list-group-item-dark" style="background-color: #141414; color: white; border-color: #333;">
                        🌍 Browse by Languages
                    </a>
                </div>
            </div>
        </div>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/login.js"></script>
    <script src="js/data.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Profile ID to avatar mapping
            const profileAvatars = {
                'paul': 'https://i.pravatar.cc/150?img=1',
                'alon': 'https://i.pravatar.cc/150?img=8', 
                'ronni': 'https://i.pravatar.cc/150?img=9',
                'anna': 'https://i.pravatar.cc/150?img=5',
                'noa': 'https://i.pravatar.cc/150?img=10'
            };
            
            // Load current profile avatar
            const profileId = localStorage.getItem('netflix:profileId');
            const profileImage = document.getElementById('profileImage');
            
            if (profileId && profileAvatars[profileId] && profileImage) {
                profileImage.src = profileAvatars[profileId];
                profileImage.style.display = 'block';
            }

            // Initialize main page content
            initializeMainPage();
        });

        function initializeMainPage() {
            const profileId = localStorage.getItem('netflix:profileId');
            if (!profileId) return;

            // Load hero content
            loadHeroContent(profileId);
            
            // Load continue watching
            loadContinueWatching(profileId);
            
            // Load trending content
            loadTrendingContent();
            
            // Load movies
            loadMovies();
            
            // Load TV shows
            loadTVShows();
            
            // Load my list
            loadMyList(profileId);
        }

        function loadHeroContent(profileId) {
            // Get featured content (first from trending)
            const allContent = NetflixData.getAllContent();
            const featuredContent = allContent[0]; // Stranger Things by default
            
            if (!featuredContent) return;

            // Update hero section
            const heroSection = document.getElementById('hero-section');
            const heroTitle = document.getElementById('hero-title');
            const heroSynopsis = document.getElementById('hero-synopsis');
            const heroPlayBtn = document.getElementById('hero-play-btn');
            const heroMoreInfoBtn = document.getElementById('hero-more-info-btn');

            heroSection.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${featuredContent.poster}')`;
            heroTitle.textContent = featuredContent.title;
            heroSynopsis.textContent = featuredContent.synopsis;

            // Check if there's progress for this content
            const progress = NetflixData.getContentProgress(profileId, featuredContent.id);
            if (progress.currentTime > 0 && !progress.completed) {
                heroPlayBtn.innerHTML = '▶️ Resume';
                heroPlayBtn.onclick = () => playContent(featuredContent.id, progress.currentTime);
            } else {
                heroPlayBtn.innerHTML = '▶️ Play';
                heroPlayBtn.onclick = () => playContent(featuredContent.id);
            }

            heroMoreInfoBtn.onclick = () => {
                window.location.href = `content-detail.html?id=${featuredContent.id}`;
            };
        }

        function loadContinueWatching(profileId) {
            const continueWatching = NetflixData.getContinueWatching(profileId, 6);
            const section = document.getElementById('continue-watching-section');
            const container = document.getElementById('continue-watching-content');

            if (continueWatching.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = '';

            continueWatching.forEach(content => {
                const progressPercentage = (content.progress.currentTime / content.duration) * 100;
                const card = createContentCard(content, true, progressPercentage);
                container.appendChild(card);
            });
        }

        function loadTrendingContent() {
            const allContent = NetflixData.getAllContent();
            // Sort by rating for trending
            const trending = allContent.sort((a, b) => b.rating - a.rating).slice(0, 6);
            
            populateContentSection('trending-content', trending);
        }

        function loadMovies() {
            const movies = NetflixData.getContentByType('movie').slice(0, 6);
            populateContentSection('movies-content', movies);
        }

        function loadTVShows() {
            const series = NetflixData.getContentByType('series').slice(0, 6);
            populateContentSection('series-content', series);
        }

        function loadMyList(profileId) {
            const userLikes = NetflixData.getUserLikes(profileId);
            const section = document.getElementById('my-list-section');
            const container = document.getElementById('my-list-content');

            if (userLikes.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = '';

            const likedContent = userLikes.map(id => NetflixData.getContentById(id)).filter(Boolean);
            likedContent.forEach(content => {
                const card = createContentCard(content);
                container.appendChild(card);
            });
        }

        function populateContentSection(containerId, content) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            content.forEach(item => {
                const card = createContentCard(item);
                container.appendChild(card);
            });
        }

        function createNetflixCard(content, showProgress = false, progressPercentage = 0, featured = false) {
            const card = document.createElement('div');
            card.className = `netflix-card ${featured ? 'featured' : ''}`;
            card.onclick = () => goToContentDetail(content.id);

            const progressBar = showProgress && progressPercentage > 0 ? 
                `<div class="progress-indicator" style="width: ${progressPercentage}%;"></div>` : '';

            card.innerHTML = `
                <img src="${content.thumbnail}" alt="${content.title}" 
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="fallback-title">${content.title}</div>
                ${progressBar}
            `;

            return card;
        }

        function createContentCard(content, showProgress = false, progressPercentage = 0) {
            return createNetflixCard(content, showProgress, progressPercentage, false);
        }

        function goToContentDetail(contentId) {
            window.location.href = `content-detail.html?id=${contentId}`;
        }

        function playContent(contentId, startTime = 0) {
            const url = `video-player.html?id=${contentId}${startTime > 0 ? `&t=${startTime}` : ''}`;
            window.location.href = url;
        }

        // Update initializeMainPage function  
        function initializeMainPage() {
            const profileId = localStorage.getItem('netflix:profileId');
            const profileName = localStorage.getItem('netflix:profileName');
            if (!profileId) return;

            // Update profile name display
            const profileNameDisplay = document.getElementById('profile-name-display');
            if (profileNameDisplay && profileName) {
                profileNameDisplay.textContent = profileName;
            }

            // Load hero content
            loadHeroContent(profileId);
            
            // Load continue watching
            loadContinueWatching(profileId);
            
            // Load all content categories
            loadTrendingContent();
            loadOriginalsContent();
            loadMovies();
            loadTVShows();
            loadActionContent();
            loadComedyContent();
            loadHorrorContent();
            loadMyList(profileId);
        }

        // New content loading functions for different categories
        function loadOriginalsContent() {
            const allContent = NetflixData.getAllContent();
            const originals = allContent.filter(content => 
                content.title.includes('Stranger Things') || 
                content.title.includes('Crown') || 
                content.title.includes('Ozark')
            ).slice(0, 10);
            populateContentSection('originals-content', originals);
        }

        function loadActionContent() {
            const actionContent = NetflixData.getContentByGenre('Action').slice(0, 10);
            populateContentSection('action-content', actionContent);
        }

        function loadComedyContent() {
            const comedyContent = NetflixData.getContentByGenre('Comedy').slice(0, 10);
            populateContentSection('comedy-content', comedyContent);
        }

        function loadHorrorContent() {
            const horrorContent = NetflixData.getContentByGenre('Horror').slice(0, 10);
            populateContentSection('horror-content', horrorContent);
        }

        // Update populateContentSection to use Netflix cards
        function populateContentSection(containerId, content) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';

            content.forEach(item => {
                const card = createNetflixCard(item);
                container.appendChild(card);
            });
        }

        // Navigation menu updates
        document.addEventListener('DOMContentLoaded', () => {
            // Add admin link if user is admin
            const email = localStorage.getItem('netflix:email');
            if (email && NetflixData.isAdmin(email)) {
                const navbar = document.querySelector('.navbar-nav');
                if (navbar) {
                    const adminLink = document.createElement('a');
                    adminLink.className = 'nav-link text-white';
                    adminLink.href = 'admin.html';
                    adminLink.style.marginRight = '20px';
                    adminLink.textContent = '⚙️ Admin';
                    navbar.appendChild(adminLink);
                }
            }
        });
    </script>
    
</body>
</html>