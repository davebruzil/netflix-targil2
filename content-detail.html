<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Netflix - Content Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="main-header">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a href="main.html" class="navbar-brand me-4">
                    <img src="images/better.png" alt="NETFLIX" class="logo-nav">
                </a>
                
                <div class="navbar-nav d-none d-lg-flex me-auto">
                    <a class="nav-link text-white" href="main.html" style="margin-right: 20px;">Home</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">TV Shows</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">Movies</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">Games</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">New & Popular</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">My List</a>
                    <a class="nav-link text-white" href="#" style="margin-right: 20px;">Browse by Languages</a>
                </div>
                
                <div class="d-flex align-items-center">
                    <div class="search-icon me-3" style="color: white; font-size: 18px; cursor: pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="notifications-icon me-3" style="color: white; font-size: 18px; cursor: pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="dropdown">
                        <div class="profile-dropdown-container d-flex align-items-center" data-bs-toggle="dropdown" style="cursor: pointer;">
                            <div class="profile-icon" id="currentProfileAvatar" style="width: 32px; height: 32px; background-color: #666; border-radius: 4px; overflow: hidden;">
                                <img id="profileImage" src="" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                            </div>
                            <div class="dropdown-arrow ms-1" style="color: white; font-size: 12px;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6 9L12 15L18 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                            <li><a class="dropdown-item" href="profiles.html">Switch Profiles</a></li>
                            <li><a class="dropdown-item" href="#">Account</a></li>
                            <li><a class="dropdown-item" href="#">Help Center</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="netflixLogout()">Sign out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-content" style="padding-top: 100px;">
        <!-- Loading State -->
        <div id="loading-state" class="text-center py-5">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <!-- Content Not Found -->
        <div id="content-not-found" class="container text-center py-5" style="display: none;">
            <h1 class="text-white mb-4">Content Not Found</h1>
            <p class="text-light mb-4">The content you're looking for doesn't exist.</p>
            <a href="main.html" class="btn btn-netflix">Back to Home</a>
        </div>

        <!-- Main Content -->
        <div id="main-content" style="display: none;">
            <!-- Hero Section -->
            <div class="hero-detail-section position-relative" style="height: 70vh; overflow: hidden;">
                <div class="hero-background position-absolute w-100 h-100" style="z-index: 1;">
                    <img id="hero-poster" src="" alt="" class="w-100 h-100" style="object-fit: cover;">
                    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: linear-gradient(135deg, rgba(0,0,0,0.8) 30%, rgba(0,0,0,0.4) 70%); z-index: 2;"></div>
                </div>
                
                <div class="container position-relative" style="z-index: 3; height: 100%; display: flex; align-items: center;">
                    <div class="row">
                        <div class="col-lg-8">
                            <h1 id="content-title" class="display-3 text-white mb-3" style="font-weight: 700;"></h1>
                            <div class="content-meta mb-3">
                                <span id="content-year" class="text-light me-3"></span>
                                <span id="content-rating" class="text-light me-3"></span>
                                <span id="content-genre" class="text-light me-3"></span>
                                <span id="content-duration" class="text-light"></span>
                            </div>
                            <p id="content-synopsis" class="lead text-light mb-4" style="max-width: 600px;"></p>
                            
                            <!-- Action Buttons -->
                            <div class="action-buttons mb-3">
                                <button id="play-btn" class="btn btn-light btn-lg me-3" style="padding: 12px 30px; border-radius: 4px; font-weight: 600;">
                                    ‚ñ∂Ô∏è Play
                                </button>
                                <button id="resume-btn" class="btn btn-light btn-lg me-3" style="padding: 12px 30px; border-radius: 4px; font-weight: 600; display: none;">
                                    ‚ñ∂Ô∏è Resume
                                </button>
                                <button id="restart-btn" class="btn btn-secondary btn-lg me-3" style="padding: 12px 30px; border-radius: 4px; background-color: rgba(109, 109, 110, 0.7); border: none; font-weight: 600; display: none;">
                                    üîÑ Start Over
                                </button>
                                <button id="like-btn" class="btn btn-outline-light btn-lg me-3" style="padding: 12px 24px; border-radius: 4px;">
                                    üëç Like
                                </button>
                                <button id="unlike-btn" class="btn btn-outline-light btn-lg me-3" style="padding: 12px 24px; border-radius: 4px; display: none;">
                                    üëé Unlike
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container-fluid mt-5">
                <!-- Episodes Section (for series) -->
                <div id="episodes-section" style="display: none;">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3 class="text-white mb-4">Episodes</h3>
                            <div id="episodes-list" class="row">
                                <!-- Episodes will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cast Information -->
                <div class="row mb-5">
                    <div class="col-12">
                        <h3 class="text-white mb-4">Cast</h3>
                        <div id="cast-list" class="row">
                            <!-- Cast will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Related Content -->
                <div class="row mb-5">
                    <div class="col-12">
                        <h3 class="text-white mb-4">More Like This</h3>
                        <div id="related-content" class="row">
                            <!-- Related content will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Episode Modal -->
    <div class="modal fade" id="episodeModal" tabindex="-1" aria-labelledby="episodeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background-color: #141414; border: none;">
                <div class="modal-header" style="border-bottom: 1px solid #333;">
                    <h5 class="modal-title text-white" id="episodeModalLabel">Episode Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <img id="episode-thumbnail" src="" alt="" class="w-100 rounded" style="aspect-ratio: 16/9; object-fit: cover;">
                        </div>
                        <div class="col-md-8">
                            <h4 id="episode-title" class="text-white mb-3"></h4>
                            <p id="episode-synopsis" class="text-light mb-3"></p>
                            <div id="episode-meta" class="text-light small mb-3"></div>
                            <button id="play-episode-btn" class="btn btn-netflix">
                                ‚ñ∂Ô∏è Play Episode
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/login.js"></script>
    <script src="js/data.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load current profile avatar
            const profileAvatars = {
                'paul': 'https://i.pravatar.cc/150?img=1',
                'alon': 'https://i.pravatar.cc/150?img=8', 
                'ronni': 'https://i.pravatar.cc/150?img=9',
                'anna': 'https://i.pravatar.cc/150?img=5',
                'noa': 'https://i.pravatar.cc/150?img=10'
            };
            
            const profileId = localStorage.getItem('netflix:profileId');
            const profileImage = document.getElementById('profileImage');
            
            if (profileId && profileAvatars[profileId] && profileImage) {
                profileImage.src = profileAvatars[profileId];
                profileImage.style.display = 'block';
            }

            // Load content details
            loadContentDetails();
        });

        function loadContentDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const contentId = urlParams.get('id');
            const profileId = localStorage.getItem('netflix:profileId');

            if (!contentId) {
                showContentNotFound();
                return;
            }

            const content = NetflixData.getContentById(contentId);
            if (!content) {
                showContentNotFound();
                return;
            }

            hideLoading();
            showMainContent(content, profileId);
        }

        function hideLoading() {
            document.getElementById('loading-state').style.display = 'none';
        }

        function showContentNotFound() {
            hideLoading();
            document.getElementById('content-not-found').style.display = 'block';
        }

        function showMainContent(content, profileId) {
            document.getElementById('main-content').style.display = 'block';
            
            // Update page title
            document.getElementById('page-title').textContent = `Netflix - ${content.title}`;
            
            // Update hero section
            document.getElementById('hero-poster').src = content.poster;
            document.getElementById('content-title').textContent = content.title;
            document.getElementById('content-year').textContent = content.year;
            document.getElementById('content-rating').textContent = `‚≠ê ${content.rating}/10`;
            document.getElementById('content-genre').textContent = content.genre;
            document.getElementById('content-synopsis').textContent = content.synopsis;

            // Format duration
            const duration = content.type === 'movie' 
                ? `${Math.floor(content.duration / 60)} min` 
                : `${content.episodes?.length || 1} episodes`;
            document.getElementById('content-duration').textContent = duration;

            // Set up action buttons
            setupActionButtons(content, profileId);

            // Load episodes if series
            if (content.type === 'series' && content.episodes) {
                loadEpisodes(content.episodes, content.id, profileId);
            }

            // Load cast
            loadCast(content.actors, content.director);

            // Load related content
            loadRelatedContent(content.id, profileId);
        }

        function setupActionButtons(content, profileId) {
            const progress = NetflixData.getContentProgress(profileId, content.id);
            const isLiked = NetflixData.isContentLiked(profileId, content.id);
            
            const playBtn = document.getElementById('play-btn');
            const resumeBtn = document.getElementById('resume-btn');
            const restartBtn = document.getElementById('restart-btn');
            const likeBtn = document.getElementById('like-btn');
            const unlikeBtn = document.getElementById('unlike-btn');

            // Show resume button if there's progress
            if (progress.currentTime > 0 && !progress.completed) {
                playBtn.style.display = 'none';
                resumeBtn.style.display = 'inline-block';
                restartBtn.style.display = 'inline-block';
            }

            // Show like/unlike state
            if (isLiked) {
                likeBtn.style.display = 'none';
                unlikeBtn.style.display = 'inline-block';
            }

            // Event listeners
            playBtn.addEventListener('click', () => playContent(content.id));
            resumeBtn.addEventListener('click', () => playContent(content.id, progress.currentTime));
            restartBtn.addEventListener('click', () => playContent(content.id, 0));
            
            likeBtn.addEventListener('click', () => toggleLike(content.id, profileId, true));
            unlikeBtn.addEventListener('click', () => toggleLike(content.id, profileId, false));
        }

        function playContent(contentId, startTime = 0) {
            const url = `video-player.html?id=${contentId}${startTime > 0 ? `&t=${startTime}` : ''}`;
            window.location.href = url;
        }

        function toggleLike(contentId, profileId, isLiking) {
            const newState = NetflixData.toggleContentLike(profileId, contentId);
            
            const likeBtn = document.getElementById('like-btn');
            const unlikeBtn = document.getElementById('unlike-btn');
            
            if (newState) {
                likeBtn.style.display = 'none';
                unlikeBtn.style.display = 'inline-block';
            } else {
                likeBtn.style.display = 'inline-block';
                unlikeBtn.style.display = 'none';
            }
        }

        function loadEpisodes(episodes, contentId, profileId) {
            const episodesSection = document.getElementById('episodes-section');
            const episodesList = document.getElementById('episodes-list');
            
            episodesSection.style.display = 'block';
            
            episodes.forEach((episode, index) => {
                const progress = NetflixData.getContentProgress(profileId, `${contentId}-${episode.id}`);
                const progressPercentage = progress.currentTime > 0 ? (progress.currentTime / episode.duration) * 100 : 0;
                
                const episodeCard = document.createElement('div');
                episodeCard.className = 'col-md-6 col-lg-4 mb-3';
                episodeCard.innerHTML = `
                    <div class="episode-card" style="background-color: #333; border-radius: 8px; overflow: hidden; cursor: pointer;" onclick="showEpisodeModal('${episode.id}', '${contentId}')">
                        <div class="episode-thumbnail" style="aspect-ratio: 16/9; background-color: #555; display: flex; align-items: center; justify-content: center; color: #fff; position: relative;">
                            <span style="font-size: 24px;">${index + 1}</span>
                            ${progressPercentage > 0 ? `
                                <div class="progress-bar" style="position: absolute; bottom: 0; left: 0; width: ${progressPercentage}%; height: 3px; background-color: #e50914;"></div>
                            ` : ''}
                        </div>
                        <div class="p-3">
                            <h6 class="text-white mb-2">${episode.title}</h6>
                            <p class="text-light small mb-0" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                ${episode.synopsis}
                            </p>
                            <div class="text-light small mt-2">${Math.floor(episode.duration / 60)} min</div>
                        </div>
                    </div>
                `;
                episodesList.appendChild(episodeCard);
            });
        }

        function showEpisodeModal(episodeId, contentId) {
            const content = NetflixData.getContentById(contentId);
            const episode = content.episodes.find(ep => ep.id === episodeId);
            
            if (!episode) return;

            document.getElementById('episode-title').textContent = episode.title;
            document.getElementById('episode-synopsis').textContent = episode.synopsis;
            document.getElementById('episode-meta').textContent = `${Math.floor(episode.duration / 60)} minutes`;
            document.getElementById('episode-thumbnail').src = content.thumbnail;
            
            const playEpisodeBtn = document.getElementById('play-episode-btn');
            playEpisodeBtn.onclick = () => {
                const url = `video-player.html?id=${contentId}&episode=${episodeId}`;
                window.location.href = url;
            };

            const modal = new bootstrap.Modal(document.getElementById('episodeModal'));
            modal.show();
        }

        function loadCast(actors, director) {
            const castList = document.getElementById('cast-list');
            
            // Add director
            const directorCard = document.createElement('div');
            directorCard.className = 'col-6 col-md-4 col-lg-2 mb-3';
            directorCard.innerHTML = `
                <div class="cast-card text-center">
                    <div class="cast-avatar mb-2" style="width: 80px; height: 80px; border-radius: 50%; background-color: #555; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: #fff;">
                        üé¨
                    </div>
                    <h6 class="text-white small mb-1">${director}</h6>
                    <p class="text-light small mb-0">Director</p>
                </div>
            `;
            castList.appendChild(directorCard);
            
            // Add actors
            actors.forEach((actor, index) => {
                const actorCard = document.createElement('div');
                actorCard.className = 'col-6 col-md-4 col-lg-2 mb-3';
                actorCard.innerHTML = `
                    <div class="cast-card text-center">
                        <div class="cast-avatar mb-2" style="width: 80px; height: 80px; border-radius: 50%; background-color: #555; margin: 0 auto; overflow: hidden;">
                            <img src="https://i.pravatar.cc/150?img=${index + 20}" alt="${actor}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <h6 class="text-white small mb-1">${actor}</h6>
                        <p class="text-light small mb-0">Actor</p>
                    </div>
                `;
                castList.appendChild(actorCard);
            });
        }

        function loadRelatedContent(contentId, profileId) {
            const relatedContent = NetflixData.getRecommendations(profileId, contentId, 6);
            const relatedContainer = document.getElementById('related-content');
            
            relatedContent.forEach(content => {
                const contentCard = document.createElement('div');
                contentCard.className = 'col-6 col-md-4 col-lg-2 mb-3';
                contentCard.innerHTML = `
                    <div class="movie-card" onclick="window.location.href='content-detail.html?id=${content.id}'" style="background-color: #333; border-radius: 4px; height: 200px; overflow: hidden; cursor: pointer; transition: transform 0.2s;">
                        <img src="${content.thumbnail}" alt="${content.title}" style="width: 100%; height: 150px; object-fit: cover;">
                        <div class="p-2">
                            <h6 class="text-white small mb-0" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                ${content.title}
                            </h6>
                        </div>
                    </div>
                `;
                relatedContainer.appendChild(contentCard);
            });
        }
    </script>
</body>
</html>